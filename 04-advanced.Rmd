# Advanced {#advanced}

```{r, echo=FALSE, include=FALSE}
library(twinetverse)

TK <- readRDS("twitter_token.rds")
```

In this chapter we essentially replicate what we did in the [Get Started chapter](get-started) but in a somewhat more advanced manner as we introduce a few new functions.

## Collect

Let's collect more tweets this time, we'll also set `include_rts = FALSE` as we dont't need the same tweet multiple times, it does not add information. We also pass a slightly more sophisticated query to the search tweet endpoint, this is often overlooked, the Twitter API provides [sophisticated operators](https://developer.twitter.com/en/docs/tweets/search/guides/standard-operators.html), you are not limited to searching for a single keyword.

We query tweets that:

- Include `#rstats`
- Include a mention i.e.: `@jdatap`
- Are not re-tweets

Remember to load your token if you're in a new environment.

```{r, eval=TRUE}
# TK <- readRDS(file = "token.rds")
tweets <- search_tweets("#rstats filter:mentions", n = 1000, token = TK, include_rts = FALSE)
```

## Build

Let's build the graph, just like we did before. There is more to graphTweets but we won't look into that just yet.

```{r, eval=TRUE}
net <- tweets %>% 
  gt_edges(text, screen_name, status_id) %>% 
  gt_nodes() %>% 
  gt_collect()
```

## Visualise

Let's make a slightly more interesting visualisation this time.

* We add labels (on hover).
* We add color (by node size).
* We layout the graph appropriately using igraph [@R-igraph].
* We use settings to change the minimum and maximum node size as well as the edges color.

```{r, eval=TRUE}
library(dplyr)

nodes <- net$nodes
edges <- net$edges

nodes <- nodes %>% 
  arrange(n_edges) %>% 
  mutate(
    id = nodes,
    label = nodes,
    size = n_edges,
    color = colorRampPalette(c("#5fc1e8", "#127ba3"))(n())
  )

edges$id <- seq(1, nrow(edges))

# Visualise
sigmajs("webgl") %>% 
  sg_nodes(nodes, id, label, size, color) %>% 
  sg_edges(edges, id, source, target) %>% 
  sg_layout(layout = igraph::layout_components) %>% 
  sg_settings(
    edgeColor = "default",
    defaultEdgeColor = "#d3d3d3",
    minNodeSize = 1,
    maxNodeSize = 4,
    minEdgeSize = 0.3,
    maxEdgeSize = 0.3
  )
```

Already looking better.